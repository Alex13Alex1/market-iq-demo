<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Market IQ ‚Äî Super Demo</title>
  <meta name="description" content="A 30-second daily market prediction game that becomes reputation, status, and creator monetization." />

  <style>
    :root{
      --bg0:#020617; --bg1:#050b1a;
      --panel: rgba(255,255,255,.06);
      --panel2: rgba(255,255,255,.085);
      --stroke: rgba(255,255,255,.10);
      --text:#e5e7eb; --muted:#94a3b8;
      --cyan:#22d3ee; --cyan2:#0891b2;
      --gold:#fbbf24; --green:#22c55e; --red:#fb7185;
      --shadow: 0 40px 120px rgba(0,0,0,.82);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif;
      color: var(--text);
      background:
        radial-gradient(1000px 700px at 18% 15%, rgba(34,211,238,.16), transparent 60%),
        radial-gradient(900px 650px at 82% 22%, rgba(251,191,36,.12), transparent 55%),
        radial-gradient(900px 650px at 60% 92%, rgba(244,63,94,.08), transparent 55%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 18px 14px;
    }
    .wrap{
      width:min(1160px,100%);
      display:grid;
      grid-template-columns: 410px 1fr;
      gap: 18px;
      align-items:start;
    }
    @media (max-width: 980px){
      body{align-items:flex-start}
      .wrap{grid-template-columns:1fr; justify-items:center;}
    }

    /* phone */
    .phone{
      width:390px; height:840px;
      border-radius:34px;
      border:1px solid rgba(255,255,255,.12);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      box-shadow: var(--shadow), 0 0 70px rgba(34,211,238,.12);
      overflow:hidden;
      position:relative;
      backdrop-filter: blur(14px);
    }
    .statusbar{
      height:44px;
      padding: 14px 16px 0;
      display:flex;
      align-items:center;
      justify-content:space-between;
      color: rgba(229,231,235,.80);
      font-size: 12px;
    }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding: 6px 10px;
      border-radius:999px;
      background: rgba(0,0,0,.25);
      border:1px solid rgba(255,255,255,.08);
    }
    .dot{width:8px;height:8px;border-radius:999px;background:var(--cyan);box-shadow:0 0 18px rgba(34,211,238,.65)}
    .app{
      height: calc(100% - 44px);
      background: linear-gradient(180deg, rgba(2,6,23,.92), rgba(2,6,23,.98));
      position:relative;
    }

    /* top */
    .top{
      padding: 14px 16px 10px;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 10px;
    }
    .brand{display:flex; flex-direction:column; gap:6px; min-width:0}
    .logo{
      font-size:11px; letter-spacing:3px; text-transform:uppercase;
      color: rgba(34,211,238,.95);
      white-space:nowrap;
    }
    .tagline{font-size:12px; color: rgba(148,163,184,.92); line-height:1.25}
    .miniStats{display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end}
    .miniCard{
      min-width:112px;
      padding: 8px 10px;
      border-radius: 14px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
    }
    .miniLabel{font-size:10px; color: rgba(148,163,184,.86)}
    .miniValue{margin-top:3px; font-weight:900; font-size: 14px}
    .c{color:var(--cyan)} .g{color:var(--green)} .y{color:var(--gold)} .r{color:var(--red)}

    .topRight{display:flex; flex-direction:column; gap:8px; align-items:flex-end}
    .topBtns{display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end}
    .topBtn{
      height:34px;
      padding: 0 10px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.25);
      color: rgba(229,231,235,.92);
      font-weight: 900;
      font-size: 12px;
      cursor:pointer;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
    }
    .topBtn.primary{
      background: linear-gradient(135deg, rgba(34,211,238,.95), rgba(8,145,178,.95));
      border-color: rgba(34,211,238,.30);
      color:#041017;
    }
    .topBtn.warn{
      background: linear-gradient(135deg, rgba(251,191,36,.95), rgba(245,158,11,.95));
      border-color: rgba(251,191,36,.25);
      color:#1b1100;
    }

    /* progress */
    .progressWrap{
      padding: 0 16px 10px;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
    }
    .progress{
      flex:1;
      height: 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.08);
      overflow:hidden;
    }
    .progress > div{
      height:100%; width: 10%;
      background: linear-gradient(90deg, rgba(34,211,238,.95), rgba(34,197,94,.95));
      transition: width .25s ease;
    }
    .stepHint{font-size:11px; color: rgba(148,163,184,.92); white-space:nowrap}

    /* screens */
    .screen{
      position:absolute;
      inset: 140px 0 74px 0; /* below top; above nav */
      overflow:hidden;
      opacity:0;
      transform: translateX(8px);
      pointer-events:none;
      transition: opacity .18s ease, transform .18s ease;
    }
    .screen.active{opacity:1; transform:translateX(0); pointer-events:auto;}
    .scroll{
      height:100%;
      overflow:auto;
      padding: 10px 16px 14px;
      scrollbar-width:none;
      -webkit-overflow-scrolling: touch;
    }
    .scroll::-webkit-scrollbar{display:none}

    .card{
      border-radius: 24px;
      background: linear-gradient(160deg, rgba(255,255,255,.085), rgba(255,255,255,.03));
      border: 1px solid rgba(255,255,255,.10);
      box-shadow: 0 18px 60px rgba(0,0,0,.28);
      overflow:hidden;
    }
    .card + .card{margin-top:12px}
    .pad{padding:16px}
    .h1{font-size:18px; font-weight:950; margin:0 0 6px}
    .h2{font-size:12px; letter-spacing:2px; text-transform:uppercase; color: rgba(148,163,184,.85); margin:0 0 10px}
    .p{color: rgba(148,163,184,.92); font-size: 13px; line-height:1.5; margin:0}

    .row{display:flex; gap:10px}
    .col{flex:1}
    .kv{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      padding: 10px 0;
      border-bottom: 1px dashed rgba(255,255,255,.10);
      font-size: 13px;
    }
    .kv:last-child{border-bottom:0}
    .kv .k{color: rgba(229,231,235,.92)}
    .kv .v{color: rgba(148,163,184,.95); font-weight: 900}

    .chipRow{display:flex; flex-wrap:wrap; gap:8px; margin-top:10px}
    .chip{
      display:inline-flex; align-items:center; gap:8px;
      padding: 7px 10px;
      border-radius: 999px;
      font-size: 12px;
      color: rgba(229,231,235,.92);
      background: rgba(0,0,0,.28);
      border: 1px solid rgba(255,255,255,.10);
    }
    .chip.cyan{border-color: rgba(34,211,238,.24); background: rgba(34,211,238,.08)}
    .chip.gold{border-color: rgba(251,191,36,.22); background: rgba(251,191,36,.10)}
    .chip.green{border-color: rgba(34,197,94,.22); background: rgba(34,197,94,.10)}
    .chip.red{border-color: rgba(244,63,94,.22); background: rgba(244,63,94,.10)}

    /* Play card */
    .hero{
      padding: 16px;
      background:
        radial-gradient(680px 380px at 15% 12%, rgba(34,211,238,.14), transparent 62%),
        radial-gradient(680px 380px at 85% 18%, rgba(251,191,36,.11), transparent 60%),
        rgba(255,255,255,.04);
    }
    .sym{font-size:12px;color: rgba(148,163,184,.92)}
    .price{font-size:34px;font-weight:980; letter-spacing:-.5px; margin-top:4px}
    .spark{
      height: 56px; border-radius: 16px;
      background: linear-gradient(90deg, rgba(34,211,238,.08), rgba(34,197,94,.06), rgba(251,191,36,.08));
      border: 1px solid rgba(255,255,255,.08);
      margin-top: 10px;
      position:relative; overflow:hidden;
    }
    .spark:before{
      content:"";
      position:absolute; inset:-60px -160px;
      background: linear-gradient(120deg, transparent, rgba(255,255,255,.10), transparent);
      transform: translateX(-40%);
      animation: shimmer 4.2s linear infinite;
    }
    @keyframes shimmer{ 0%{transform: translateX(-40%)} 100%{transform: translateX(40%)} }

    .context{
      margin-top: 12px;
      padding: 12px 12px;
      border-radius: 18px;
      background: rgba(0,0,0,.26);
      border: 1px solid rgba(255,255,255,.10);
    }
    .contextTop{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      margin-bottom: 8px;
    }
    .ctxTitle{font-size:11px; letter-spacing:2px; text-transform:uppercase; color: rgba(148,163,184,.86)}
    .ctxHint{font-size:11px; color: rgba(148,163,184,.92)}
    .ctxLine{
      font-size: 13px;
      color: rgba(229,231,235,.92);
      line-height: 1.35;
      display:flex;
      gap: 8px;
      padding: 6px 0;
      border-bottom: 1px dashed rgba(255,255,255,.10);
    }
    .ctxLine:last-child{border-bottom:0}
    .ctxEmoji{width:18px; text-align:center}

    .question{padding: 14px 16px; border-top: 1px solid rgba(255,255,255,.06)}
    .qTitle{font-size: 16px; font-weight: 950; line-height:1.25}
    .qMeta{margin-top:8px; display:flex; justify-content:space-between; gap:10px; color: rgba(148,163,184,.92); font-size: 12px}
    .bar{
      height: 10px; border-radius: 999px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.08);
      overflow:hidden;
      margin-top: 8px;
    }
    .bar > div{
      height:100%;
      width: 63%;
      background: linear-gradient(90deg, rgba(34,211,238,.95), rgba(34,197,94,.95));
      transition: width .25s ease;
    }

    .btnRow{
      padding: 12px 16px 16px;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    button{-webkit-tap-highlight-color: transparent}
    .btn{
      height: 70px;
      border-radius: 18px;
      border: none;
      font-size: 18px;
      font-weight: 980;
      cursor:pointer;
      transition: transform .12s ease, filter .12s ease;
      user-select:none;
    }
    .btn:active{transform: scale(.985)}
    .btn.up{background: linear-gradient(135deg, #22c55e, #16a34a); color:#06100a; box-shadow:0 16px 40px rgba(34,197,94,.18)}
    .btn.down{background: linear-gradient(135deg, #fb7185, #e11d48); color:white; box-shadow:0 16px 40px rgba(244,63,94,.18)}
    .btn.ghost{
      grid-column: 1 / 3;
      height: 46px;
      font-size: 13px;
      font-weight: 950;
      border-radius: 14px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
      color: rgba(229,231,235,.92);
      box-shadow:none;
    }
    .btn.primarySmall{
      height: 46px;
      font-size: 13px;
      font-weight: 980;
      border-radius: 14px;
      background: linear-gradient(135deg, rgba(34,211,238,.95), rgba(251,191,36,.22));
      color:#041017;
      border: 1px solid rgba(34,211,238,.25);
    }

    /* bottom nav */
    .nav{
      position:absolute; left:0; right:0; bottom:0;
      height: 74px;
      display:flex; justify-content:space-around; align-items:center;
      background: rgba(0,0,0,.35);
      border-top: 1px solid rgba(255,255,255,.08);
      backdrop-filter: blur(16px);
    }
    .nav .item{
      width: 64px;
      display:flex; flex-direction:column; align-items:center; justify-content:center;
      gap: 6px;
      color: rgba(148,163,184,.92);
      font-size: 10px;
      cursor:pointer;
      user-select:none;
    }
    .nav .ico{
      width: 40px; height: 40px;
      border-radius: 14px;
      display:flex; align-items:center; justify-content:center;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.10);
      font-size: 18px;
    }
    .nav .item.active{color: rgba(229,231,235,.95)}
    .nav .item.active .ico{
      background: linear-gradient(135deg, rgba(34,211,238,.95), rgba(8,145,178,.95));
      border-color: rgba(34,211,238,.30);
      color:#041017;
      box-shadow: 0 14px 40px rgba(34,211,238,.14);
    }

    /* modal */
    .overlay{
      position:absolute; inset:0;
      display:none;
      align-items:flex-end;
      justify-content:center;
      padding: 14px;
      background: rgba(2,6,23,.65);
      backdrop-filter: blur(10px);
    }
    .overlay.show{display:flex}
    .sheet{
      width:100%;
      border-radius: 26px;
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.05));
      border: 1px solid rgba(255,255,255,.12);
      box-shadow: 0 30px 120px rgba(0,0,0,.70);
      overflow:hidden;
    }
    .sheetTop{
      padding: 14px 14px 10px;
      display:flex; justify-content:space-between; gap: 12px;
    }
    .sheetTop h3{margin:0; font-size: 16px}
    .sheetTop p{margin:6px 0 0; font-size: 12px; color: rgba(148,163,184,.92); line-height:1.35}
    .xbtn{
      width: 40px; height: 40px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.35);
      color: rgba(229,231,235,.92);
      cursor:pointer;
      font-weight: 980;
      user-select:none;
    }
    .sheetGrid{
      padding: 0 14px 14px;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    .big{
      padding: 12px;
      border-radius: 18px;
      background: rgba(0,0,0,.28);
      border: 1px solid rgba(255,255,255,.10);
    }
    .big .lab{font-size: 10px; color: rgba(148,163,184,.86)}
    .big .val{margin-top:4px; font-size: 18px; font-weight: 980}
    .sheetActions{
      padding: 0 14px 14px;
      display:flex; gap: 10px;
    }
    .sheetActions .btn.ghost{height:44px; grid-column:auto; flex:1}
    .sheetActions .btn.primarySmall{height:44px; flex:1}

    /* share card chooser */
    .tabs{display:flex; gap:8px; flex-wrap:wrap; margin-top:10px}
    .tab{
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.24);
      font-size: 12px;
      font-weight: 900;
      color: rgba(229,231,235,.92);
      cursor:pointer;
      user-select:none;
    }
    .tab.active{background: rgba(34,211,238,.14); border-color: rgba(34,211,238,.28); color: rgba(229,231,235,.95)}
    .hint{margin-top:10px;font-size:12px;color:rgba(148,163,184,.92)}

    /* right deck */
    .deck{
      border-radius: 26px;
      padding: 18px;
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border: 1px solid rgba(255,255,255,.12);
      box-shadow: 0 30px 100px rgba(0,0,0,.45);
      backdrop-filter: blur(14px);
    }
    .deck h1{margin:0 0 8px; font-size: 22px; letter-spacing:-.4px;}
    .deck .sub{margin:0; color: rgba(148,163,184,.92); line-height: 1.55; font-size: 14px;}
    .pillRow{display:flex; flex-wrap:wrap; gap:8px; margin-top: 12px}
    .pill2{
      padding: 8px 10px;
      border-radius: 999px;
      background: rgba(0,0,0,.28);
      border: 1px solid rgba(255,255,255,.10);
      font-size: 12px;
      color: rgba(229,231,235,.92);
    }
    .pill2 b{color: var(--cyan)}
    .hr{height:1px;background: rgba(255,255,255,.10);margin: 14px 0}
    .box{
      padding: 12px;
      border-radius: 18px;
      background: rgba(0,0,0,.25);
      border: 1px solid rgba(255,255,255,.10);
      margin-top: 10px;
    }
    .box h4{margin:0 0 6px; font-size: 13px}
    .box p{margin:0; font-size: 12px; color: rgba(148,163,184,.92); line-height:1.45}
    .mono{
      margin-top: 10px;
      padding: 10px;
      border-radius: 14px;
      background: rgba(0,0,0,.22);
      border: 1px solid rgba(255,255,255,.10);
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-size: 12px;
      white-space: pre-wrap;
      color: rgba(229,231,235,.92);
    }
    a{color: var(--cyan); text-decoration:none}
    a:hover{text-decoration:underline}

    @media (prefers-reduced-motion: reduce){
      .screen, .progress > div, .bar > div, .spark:before { transition:none !important; animation:none !important; }
    }
  </style>
</head>

<body>
  <div class="wrap">

    <!-- PHONE -->
    <div class="phone" id="phone">
      <div class="statusbar">
        <div class="pill"><span class="dot"></span><span id="sbSeason">Season 0</span></div>
        <div class="pill" id="sbReset">Reset in --:--:--</div>
      </div>

      <div class="app">

        <div class="top">
          <div class="brand">
            <div class="logo">MARKET IQ</div>
            <div class="tagline">UP / DOWN ‚Üí reputation ‚Üí status ‚Üí creator.</div>
          </div>

          <div class="topRight">
            <div class="topBtns">
              <button class="topBtn primary" id="btnPitch">Pitch mode</button>
              <button class="topBtn" id="btnSound">Sound: OFF</button>
              <button class="topBtn warn" id="btnShareCardTop">Share-card</button>
            </div>
            <div class="miniStats">
              <div class="miniCard">
                <div class="miniLabel">Market IQ</div>
                <div class="miniValue"><span class="c" id="uiIQ">1000</span> ‚Ä¢ <span class="y" id="uiLeague">Bronze</span></div>
              </div>
              <div class="miniCard">
                <div class="miniLabel">Identity</div>
                <div class="miniValue" id="uiType">‚Äî</div>
              </div>
            </div>
          </div>
        </div>

        <div class="progressWrap">
          <div class="progress"><div id="uiProg"></div></div>
          <div class="stepHint" id="uiStepHint">Step 1/3</div>
        </div>

        <!-- ONBOARD 1 -->
        <section class="screen active" id="s-on1">
          <div class="scroll">
            <div class="card">
              <div class="pad">
                <div class="h1">Are you smarter than the crowd?</div>
                <p class="p">One question per day. Two buttons. No charts needed.</p>
                <div class="chipRow">
                  <span class="chip cyan">30 seconds/day</span>
                  <span class="chip gold">Status & leagues</span>
                  <span class="chip green">Share to flex</span>
                </div>
              </div>
            </div>

            <div class="card">
              <div class="pad">
                <div class="h2>Why people invite friends</div>
                <div class="kv"><span class="k">‚ÄúI beat 80% of traders‚Äù</span><span class="v y">Status</span></div>
                <div class="kv"><span class="k">7-day duel</span><span class="v c">Rivalry</span></div>
                <div class="kv"><span class="k">Weekly seasons</span><span class="v y">Fresh start</span></div>
                <button class="btn primarySmall" id="btnOn1">Continue</button>
              </div>
            </div>

            <div class="hint">Swipe left/right to move. (Pitch mode runs this automatically.)</div>
          </div>
        </section>

        <!-- ONBOARD 2 -->
        <section class="screen" id="s-on2">
          <div class="scroll">
            <div class="card">
              <div class="pad">
                <div class="h1">You get an identity (not just a score).</div>
                <p class="p">Your choices reveal your mind style: Momentum, Contrarian, Data-Mind‚Ä¶</p>
                <div class="chipRow">
                  <span class="chip cyan">Easy gameplay</span>
                  <span class="chip gold">Deep meaning</span>
                  <span class="chip">Evolves weekly</span>
                </div>
              </div>
            </div>

            <div class="card">
              <div class="pad">
                <div class="h2>Endgame</div>
                <div class="kv"><span class="k">Verified Mind</span><span class="v c">Access</span></div>
                <div class="kv"><span class="k">Market Voice</span><span class="v y">Influence</span></div>
                <div class="kv"><span class="k">Signal Creator</span><span class="v g">Monetize</span></div>
                <button class="btn primarySmall" id="btnOn2">Continue</button>
              </div>
            </div>
          </div>
        </section>

        <!-- ONBOARD 3 -->
        <section class="screen" id="s-on3">
          <div class="scroll">
            <div class="card">
              <div class="pad">
                <div class="h1">Daily Market Battle.</div>
                <p class="p">You vs Crowd vs Experts. Every day creates a shareable story.</p>
                <div class="chipRow">
                  <span class="chip gold">Crowd vs You</span>
                  <span class="chip cyan">Share cards</span>
                  <span class="chip green">Duel friends</span>
                </div>
              </div>
            </div>

            <div class="card">
              <div class="pad">
                <div class="h2>Ready?</div>
                <div class="kv"><span class="k">Genesis badge</span><span class="v y" id="uiGenesis">ON</span></div>
                <div class="kv"><span class="k">Season reset</span><span class="v">Sunday 23:59</span></div>
                <button class="btn primarySmall" id="btnStartPlay">Start playing</button>
                <button class="btn ghost" id="btnResetAll">Reset demo</button>
              </div>
            </div>
          </div>
        </section>

        <!-- PLAY -->
        <section class="screen" id="s-play">
          <div class="scroll">
            <div class="card">
              <div class="hero">
                <div class="sym" id="qSym">BTC / USD</div>
                <div class="price" id="qPx">$98,500</div>
                <div class="spark" aria-hidden="true"></div>

                <div class="chipRow">
                  <span class="chip cyan" id="qMode">Daily Pulse</span>
                  <span class="chip">Closes in <b id="qTimer">--:--:--</b></span>
                  <span class="chip gold">Crowd <b id="qCrowd">63%</b> UP</span>
                </div>

                <div class="context">
                  <div class="contextTop">
                    <div class="ctxTitle">Context</div>
                    <div class="ctxHint" id="ctxRefresh">tap ‚ÄúNext demo question‚Äù</div>
                  </div>
                  <div id="ctxLines"></div>
                </div>
              </div>

              <div class="question">
                <div class="qTitle" id="qTitle">Will price be higher in 24h?</div>
                <div class="qMeta">
                  <span id="qHorizon">Horizon: 24h</span>
                  <span>You: <b id="qChance">58%</b> edge</span>
                </div>
                <div class="bar"><div id="qBar"></div></div>
              </div>

              <div class="btnRow">
                <button class="btn up" id="btnUp">‚¨Ü UP</button>
                <button class="btn down" id="btnDown">‚¨á DOWN</button>
                <button class="btn ghost" id="btnNextQ">Next demo question ‚ñ∏</button>
              </div>
            </div>

            <div class="row" style="gap:12px;">
              <div class="card col">
                <div class="pad">
                  <div class="h2">Today</div>
                  <div class="kv"><span class="k">Answered</span><span class="v" id="uiAnswered">0/1</span></div>
                  <div class="kv"><span class="k">Edge vs crowd</span><span class="v g" id="uiEdge">+0</span></div>
                </div>
              </div>
              <div class="card col">
                <div class="pad">
                  <div class="h2>Battle</div>
                  <div class="kv"><span class="k">You</span><span class="v y" id="uiYouScore">0</span></div>
                  <div class="kv"><span class="k">Crowd</span><span class="v c" id="uiCrowdScore">0</span></div>
                </div>
              </div>
            </div>

            <div class="card">
              <div class="pad">
                <div class="h2>Simple rule</div>
                <p class="p">Tap UP/DOWN ‚Üí earn Market IQ ‚Üí climb leagues ‚Üí unlock Creator.</p>
              </div>
            </div>
          </div>
        </section>

        <!-- RECAP -->
        <section class="screen" id="s-recap">
          <div class="scroll">
            <div class="card">
              <div class="pad">
                <div class="h1">Recap (share this)</div>
                <p class="p">This is your daily flex. People share status, not analysis.</p>

                <div class="row" style="margin-top:10px;">
                  <div class="card col" style="background:rgba(0,0,0,.25); border:1px solid rgba(255,255,255,.10); box-shadow:none;">
                    <div class="pad">
                      <div class="h2">You</div>
                      <div class="miniValue y" style="font-size:18px;" id="recYou">0/1</div>
                      <div class="p" style="margin-top:6px;">Your result today.</div>
                    </div>
                  </div>
                  <div class="card col" style="background:rgba(0,0,0,.25); border:1px solid rgba(255,255,255,.10); box-shadow:none;">
                    <div class="pad">
                      <div class="h2">Crowd</div>
                      <div class="miniValue c" style="font-size:18px;" id="recCrowd">0/1</div>
                      <div class="p" style="margin-top:6px;">Majority result.</div>
                    </div>
                  </div>
                </div>

                <div class="chipRow" style="margin-top:10px;">
                  <span class="chip">Top <b id="recTop">‚Äî</b></span>
                  <span class="chip">Streak <b id="recStreak">0</b></span>
                  <span class="chip cyan">IQ <b id="recIQ">1000</b></span>
                  <span class="chip gold">Type <b id="recType">‚Äî</b></span>
                </div>

                <div class="tabs">
                  <div class="tab active" data-card="status">STATUS</div>
                  <div class="tab" data-card="battle">YOU vs CROWD</div>
                  <div class="tab" data-card="streak">STREAK</div>
                </div>

                <div class="row" style="margin-top:12px;">
                  <button class="btn primarySmall col" id="btnShareText">Share text</button>
                  <button class="btn ghost col" id="btnSharePNG">Share-card PNG</button>
                </div>
                <div class="hint" id="shareHint" style="display:none;">Saved / shared ‚úÖ</div>
              </div>
            </div>

            <div class="card">
              <div class="pad">
                <div class="h2>Recent picks (demo)</div>
                <div id="hist"></div>
              </div>
            </div>
          </div>
        </section>

        <!-- LEAGUES -->
        <section class="screen" id="s-leagues">
          <div class="scroll">
            <div class="card">
              <div class="pad">
                <div class="h1">Leagues & Seasons</div>
                <p class="p">Weekly reset makes it alive. Fresh drama every week.</p>

                <div class="row" style="margin-top:10px;">
                  <div class="card col" style="background:rgba(0,0,0,.25); border:1px solid rgba(255,255,255,.10); box-shadow:none;">
                    <div class="pad">
                      <div class="h2">Your league</div>
                      <div class="miniValue y" style="font-size:18px;" id="lgLeague">Bronze</div>
                      <div class="p" style="margin-top:6px;">Promotion: Top 20%</div>
                    </div>
                  </div>
                  <div class="card col" style="background:rgba(0,0,0,.25); border:1px solid rgba(255,255,255,.10); box-shadow:none;">
                    <div class="pad">
                      <div class="h2">Reset</div>
                      <div class="miniValue c" style="font-size:18px;" id="lgReset">--:--:--</div>
                      <div class="p" style="margin-top:6px;" id="lgSeason">Season 0</div>
                    </div>
                  </div>
                </div>

                <div class="kv"><span class="k">Genesis badge</span><span class="v y" id="lgGenesis">Enabled</span></div>
                <div class="kv"><span class="k">Verified Mind unlock</span><span class="v c" id="lgVerified">Locked</span></div>
                <div class="kv"><span class="k">Signal Creator unlock</span><span class="v g" id="lgCreator">Locked</span></div>

                <div class="hint">Demo reset uses your device time. (No backend.)</div>
              </div>
            </div>

            <div class="card">
              <div class="pad">
                <div class="h2>Global leaderboard (demo)</div>
                <div id="lb"></div>
              </div>
            </div>
          </div>
        </section>

        <!-- CROWD -->
        <section class="screen" id="s-crowd">
          <div class="scroll">
            <div class="card">
              <div class="pad">
                <div class="h1">Crowd vs Experts (X machine)</div>
                <p class="p">Every day you can post one line: ‚ÄúCrowd was wrong/right‚Äù.</p>
                <div class="chipRow">
                  <span class="chip cyan">Crowd score <b id="cveCrowd">0</b></span>
                  <span class="chip gold">Experts score <b id="cveExperts">0</b></span>
                </div>
                <div class="kv"><span class="k">Post ready</span><span class="v" id="cveScore">Crowd 0 ‚Äî Experts 0</span></div>
                <button class="btn primarySmall" id="btnHotPost">Copy X post</button>
              </div>
            </div>

            <div class="card">
              <div class="pad">
                <div class="h2>Friends duel (demo)</div>
                <div class="kv"><span class="k">7-day duel</span><span class="v" id="duelState">Inactive</span></div>
                <div class="kv"><span class="k">You</span><span class="v y" id="duelYou">0</span></div>
                <div class="kv"><span class="k">Friend</span><span class="v c" id="duelFriend">0</span></div>
                <button class="btn ghost" id="btnStartDuel">Start demo duel</button>
              </div>
            </div>

            <div class="card">
              <div class="pad">
                <div class="h2>Random reward (dopamine)</div>
                <div class="kv"><span class="k">Mystery drops</span><span class="v y" id="dropState">‚Äî</span></div>
                <p class="p">Sometimes you unlock a tiny bonus. This creates ‚Äúone more day‚Äù behavior.</p>
              </div>
            </div>
          </div>
        </section>

        <!-- PROFILE -->
        <section class="screen" id="s-profile">
          <div class="scroll">
            <div class="card">
              <div class="pad">
                <div class="h1">Your Market Passport</div>
                <p class="p">Your identity + reputation. Built for screenshots.</p>

                <div class="row" style="margin-top:10px;">
                  <div class="card col" style="background:rgba(0,0,0,.25); border:1px solid rgba(255,255,255,.10); box-shadow:none;">
                    <div class="pad">
                      <div class="h2">Market IQ</div>
                      <div class="miniValue c" style="font-size:18px;" id="pfIQ">1000</div>
                      <div class="p" style="margin-top:6px;" id="pfLeague">Bronze</div>
                    </div>
                  </div>
                  <div class="card col" style="background:rgba(0,0,0,.25); border:1px solid rgba(255,255,255,.10); box-shadow:none;">
                    <div class="pad">
                      <div class="h2">Accuracy</div>
                      <div class="miniValue g" style="font-size:18px;" id="pfAcc">‚Äî</div>
                      <div class="p" style="margin-top:6px;">Last picks</div>
                    </div>
                  </div>
                </div>

                <div class="chipRow" id="pfBadges"></div>
              </div>
            </div>

            <div class="card">
              <div class="pad">
                <div class="h2>Identity evolution</div>
                <div class="kv"><span class="k">Current</span><span class="v y" id="pfType">‚Äî</span></div>
                <div class="kv"><span class="k">Path</span><span class="v" id="pfEvo">‚Äî</span></div>
                <p class="p">Your mind style changes week to week as you play.</p>
              </div>
            </div>

            <div class="card">
              <div class="pad">
                <div class="h2>Path to Creator</div>
                <div class="kv"><span class="k">Eligibility</span><span class="v" id="pfElig">Not yet</span></div>
                <div class="kv"><span class="k">Requirement</span><span class="v">IQ ‚â• 1200 + Streak ‚â• 7</span></div>
                <button class="btn primarySmall" id="btnCreator">Preview Creator</button>
              </div>
            </div>
          </div>
        </section>

        <!-- CREATOR -->
        <section class="screen" id="s-creator">
          <div class="scroll">
            <div class="card">
              <div class="pad">
                <div class="h1">Signal Creator (endgame)</div>
                <p class="p">Monetize reputation. Retail subscribes because your history is measurable.</p>

                <div class="kv"><span class="k">Creator status</span><span class="v" id="crStatus">Locked</span></div>
                <div class="kv"><span class="k">Public page</span><span class="v">Signals + track record</span></div>
                <div class="kv"><span class="k">Revenue share</span><span class="v g">Enabled</span></div>

                <div class="card" style="margin-top:12px; background:rgba(0,0,0,.25); border:1px solid rgba(255,255,255,.10); box-shadow:none;">
                  <div class="pad">
                    <div class="h2>What retail sees</div>
                    <div class="kv"><span class="k">Accuracy</span><span class="v" id="crAcc">‚Äî</span></div>
                    <div class="kv"><span class="k">Streak</span><span class="v" id="crStreak">0</span></div>
                    <div class="kv"><span class="k">League</span><span class="v" id="crLeague">Bronze</span></div>
                    <div class="kv"><span class="k">Mind type</span><span class="v y" id="crType">‚Äî</span></div>
                  </div>
                </div>

                <button class="btn ghost" id="btnBackHome">Back to Play</button>
              </div>
            </div>

            <div class="hint">Demo only ‚Äî real product needs verified market data + anti-cheat.</div>
          </div>
        </section>

        <!-- NAV -->
        <div class="nav" id="nav">
          <div class="item" data-go="s-play"><div class="ico">üéÆ</div><div>Play</div></div>
          <div class="item" data-go="s-recap"><div class="ico">üìà</div><div>Recap</div></div>
          <div class="item" data-go="s-leagues"><div class="ico">üèÜ</div><div>Leagues</div></div>
          <div class="item" data-go="s-crowd"><div class="ico">‚öîÔ∏è</div><div>Crowd</div></div>
          <div class="item" data-go="s-profile"><div class="ico">üë§</div><div>You</div></div>
        </div>

        <!-- REWARD MODAL -->
        <div class="overlay" id="overlay">
          <div class="sheet">
            <div class="sheetTop">
              <div>
                <h3 id="rwTitle">Pick submitted ‚úÖ</h3>
                <p id="rwDesc">Instant reward (demo). Tomorrow you‚Äôd see the final result.</p>
              </div>
              <button class="xbtn" id="rwClose">‚úï</button>
            </div>

            <div class="sheetGrid">
              <div class="big">
                <div class="lab">Market IQ</div>
                <div class="val c" id="rwIQ">+12</div>
              </div>
              <div class="big">
                <div class="lab">Streak</div>
                <div class="val y" id="rwStreak">+1</div>
              </div>
              <div class="big">
                <div class="lab">Edge vs crowd</div>
                <div class="val g" id="rwEdge">+1</div>
              </div>
              <div class="big">
                <div class="lab">Mystery drop</div>
                <div class="val y" id="rwDrop">‚Äî</div>
              </div>
            </div>

            <div class="sheetActions">
              <button class="btn ghost" id="rwShareText">Share text</button>
              <button class="btn primarySmall" id="rwGoRecap">Go to Recap</button>
            </div>
          </div>
        </div>

      </div>
    </div>

    <!-- RIGHT EXPLAINER -->
    <div class="deck">
      <h1>Market IQ ‚Äî Super Demo</h1>
      <p class="sub">
        Built for retail simplicity: <b>UP / DOWN</b> once per day.<br/>
        Built for viral growth: <b>identity</b> + <b>status share cards</b> + <b>crowd drama</b>.
      </p>

      <div class="pillRow">
        <div class="pill2"><b>Context:</b> 2 lines (illusion of analysis)</div>
        <div class="pill2"><b>Cards:</b> status / battle / streak</div>
        <div class="pill2"><b>Audio:</b> micro dopamine</div>
        <div class="pill2"><b>Reset:</b> weekly seasons</div>
        <div class="pill2"><b>Pitch:</b> auto walkthrough</div>
      </div>

      <div class="hr"></div>

      <div class="box">
        <h4>What you post on X</h4>
        <p>Don‚Äôt sell the site ‚Äî post the story: ‚ÄúCrowd vs Me‚Äù.</p>
        <div class="mono" id="xCopy">
Crowd: 63% UP on BTC
I chose DOWN
My Market IQ: 1000 (Bronze)
Can you beat me?
        </div>
      </div>

      <div class="box">
        <h4>Fast demo tip</h4>
        <p>Tap <b>Pitch mode</b> ‚Üí show onboarding 1‚Üí2‚Üí3 ‚Üí lands on Play.</p>
      </div>

      <div class="hint">This is a single-file GitHub Pages demo. No libraries, no backend.</div>
    </div>

  </div>

<script>
/* ================== State ================== */
const KEY = "market_iq_super_demo_v3";
const clamp = (x,a,b)=>Math.max(a,Math.min(b,x));
const todayISO = ()=> new Date().toISOString().slice(0,10);
const $ = (id)=>document.getElementById(id);

const defaultState = () => ({
  season: 0,
  genesis: true,
  iq: 1000,
  streak: 0,
  lastPlayDate: null,
  answeredToday: 0,
  edgeToday: 0,
  picks: [], // {date,sym,horizon,choice,crowdUp,outcome,correct,crowdCorrect}
  battle: { you:0, crowd:0 }, // season
  cve: { crowd:0, experts:0 }, // season
  duel: { active:false, you:0, friend:0 }, // season
  drops: { last:"‚Äî", unlocked:0 },
  sound: false,
  shareCardMode: "status",
  identity: {
    type: "‚Äî",
    evo: [],
    weekStart: "",
    stats: { momentum:0, contrarian:0, crowdFollow:0 }
  },
  seasonKey: "" // to detect weekly reset
});

let state = load();

function load(){
  try{
    const raw = localStorage.getItem(KEY);
    if(!raw) return defaultState();
    return { ...defaultState(), ...JSON.parse(raw) };
  }catch{
    return defaultState();
  }
}
function save(){ localStorage.setItem(KEY, JSON.stringify(state)); }

/* ================== Weekly season reset (Sunday 23:59 local) ==================
   We compute "seasonKey" as week number + year (local) and reset when it changes.
*/
function getWeekKey(d=new Date()){
  // local week key (simple, stable for demo)
  const date = new Date(d.getFullYear(), d.getMonth(), d.getDate());
  // Thursday method
  const day = (date.getDay() + 6) % 7; // Monday=0
  date.setDate(date.getDate() - day + 3);
  const firstThursday = new Date(date.getFullYear(),0,4);
  const diff = date - firstThursday;
  const week = 1 + Math.round(diff / 604800000);
  return `${date.getFullYear()}-W${String(week).padStart(2,"0")}`;
}

function weeklyResetIfNeeded(){
  const wk = getWeekKey();
  if(!state.seasonKey){
    state.seasonKey = wk;
    if(!state.identity.weekStart) state.identity.weekStart = wk;
    save();
    return;
  }
  if(state.seasonKey !== wk){
    state.season += 1;
    state.seasonKey = wk;

    // reset seasonal competition counters (keep IQ/streak for demo)
    state.battle = { you:0, crowd:0 };
    state.cve = { crowd:0, experts:0 };
    state.duel = { active:false, you:0, friend:0 };
    state.answeredToday = 0;
    state.edgeToday = 0;
    state.drops.last = "‚Äî";

    // identity evolution weekly snapshot
    finalizeWeeklyIdentity(wk);

    save();
  }
}

/* ================== Next reset countdown (Sunday 23:59:59 local) ================== */
function msToHMS(ms){
  const s = Math.max(0, Math.floor(ms/1000));
  const h = String(Math.floor(s/3600)).padStart(2,"0");
  const m = String(Math.floor((s%3600)/60)).padStart(2,"0");
  const ss = String(s%60).padStart(2,"0");
  return `${h}:${m}:${ss}`;
}
function nextSundayEnd(){
  const now = new Date();
  const end = new Date(now);
  // Sunday is 0 in JS. We want the next Sunday (including today if Sunday but before end of day).
  const day = now.getDay(); // 0..6
  const daysToSunday = (7 - day) % 7;
  end.setDate(now.getDate() + daysToSunday);
  end.setHours(23,59,59,999);
  // if it's already past this sunday end (edge), add 7
  if(end.getTime() < now.getTime()) end.setDate(end.getDate() + 7);
  return end;
}
function updateResetBadge(){
  const end = nextSundayEnd();
  const ms = end - new Date();
  const txt = "Reset in " + msToHMS(ms);
  const sb = $("sbReset");
  if(sb) sb.textContent = txt;
  const lg = $("lgReset");
  if(lg) lg.textContent = msToHMS(ms);
}

/* ================== Questions + Context snippets ================== */
const QUESTIONS = [
  { sym:"BTC / USD", px:98500, horizon:"24h", crowdUp:63, title:"Will BTC be higher in 24h?", chance:"58%", mode:"Daily Pulse" },
  { sym:"ETH / USD", px:3420, horizon:"24h", crowdUp:56, title:"Will ETH close higher tomorrow?", chance:"54%", mode:"Daily Pulse" },
  { sym:"NASDAQ / QQQ", px:476, horizon:"7d", crowdUp:48, title:"Will Nasdaq be higher next week?", chance:"52%", mode:"Weekly Pulse" },
  { sym:"GOLD / XAU", px:2340, horizon:"7d", crowdUp:60, title:"Will Gold be higher next week?", chance:"55%", mode:"Weekly Pulse" },
  { sym:"USDJPY", px:148.2, horizon:"48h", crowdUp:51, title:"Will USDJPY be higher in 48h?", chance:"53%", mode:"Daily Pulse" }
];

const CONTEXT_POOL = [
  ["üöÄ","Elon posted a Doge meme"],
  ["üè¶","Fed hinted rates stay higher"],
  ["üìâ","Liquidations spiked in last hour"],
  ["üìà","ETF inflows accelerated today"],
  ["üß†","Sentiment index flipped bullish"],
  ["üßä","Whale moved coins to exchange"],
  ["üß®","Macro data came in hotter than expected"],
  ["üó£Ô∏è","Central bank speech in 2 hours"],
  ["‚ö°","Volatility expanded after breakout"],
  ["üßæ","Large options expiry nearby"]
];

let qIndex = 0;

/* ================== Helpers ================== */
const money = (n)=>{
  const isInt = Math.abs(n) >= 100 || Number.isInteger(n);
  const v = isInt ? Math.round(n).toLocaleString() : n.toFixed(2);
  return "$" + v;
};
function leagueFromIQ(iq){
  if(iq>=1550) return "Legend";
  if(iq>=1400) return "Diamond";
  if(iq>=1250) return "Gold";
  if(iq>=1120) return "Silver";
  return "Bronze";
}
function accuracyLast(n=30){
  const slice = state.picks.slice(0,n);
  if(slice.length===0) return null;
  const ok = slice.filter(p=>p.correct).length;
  return (ok/slice.length)*100;
}
function topPercentApprox(iq){
  if(iq>=1550) return "0.5%";
  if(iq>=1400) return "2%";
  if(iq>=1250) return "10%";
  if(iq>=1120) return "25%";
  return "60%";
}
function closeTimerText(){
  const d = new Date();
  const end = new Date(d);
  end.setHours(23,59,59,999);
  const ms = Math.max(0, end-d);
  return msToHMS(ms);
}
function crowdPickFromPct(crowdUp){ return (crowdUp >= 50) ? "UP" : "DOWN"; }

/* ================== Identity (Thinking Type) ==================
   We derive a simple "mind type" from how user picks relative to crowd:
   - If user frequently chooses against crowd => Contrarian
   - If user follows crowd => Crowd-Follower
   - If user alternates / balanced => Data-Mind
   We also bias Momentum if user repeats same direction 2+ times.
*/
function recomputeIdentity(){
  const last = state.picks.slice(0, 20);
  if(last.length === 0){
    state.identity.type = "Newbie";
    return;
  }
  let contra = 0, follow = 0, mom = 0;
  for(let i=0;i<last.length;i++){
    const p = last[i];
    const crowd = crowdPickFromPct(p.crowdUp);
    if(p.choice !== crowd) contra++;
    else follow++;
    // momentum: same as previous pick direction
    if(i>0 && last[i-1].choice === p.choice) mom++;
  }
  // store stats
  state.identity.stats.momentum = mom;
  state.identity.stats.contrarian = contra;
  state.identity.stats.crowdFollow = follow;

  // type selection
  const total = Math.max(1, contra + follow);
  const contraRate = contra / total;
  const followRate = follow / total;

  let type = "Data Mind";
  if(contraRate >= 0.62) type = "Contrarian Mind";
  else if(followRate >= 0.62) type = "Crowd Follower";
  else if(mom >= Math.min(6, Math.floor(last.length/2))) type = "Momentum Hunter";

  state.identity.type = type;
}

function finalizeWeeklyIdentity(newWeekKey){
  // save previous week type into evolution path
  recomputeIdentity();
  const type = state.identity.type || "Data Mind";
  const evo = state.identity.evo || [];
  const prevWeek = state.identity.weekStart || state.seasonKey || getWeekKey();
  // record snapshot once per week boundary
  if(evo.length===0 || evo[0].week !== prevWeek){
    evo.unshift({ week: prevWeek, type });
    state.identity.evo = evo.slice(0, 8);
  }
  state.identity.weekStart = newWeekKey;
}

/* ================== Minimal sound (no external files) ==================
   Uses WebAudio short beeps. Works only after user interaction.
*/
let audioCtx = null;
function ensureAudio(){
  if(!audioCtx){
    const Ctx = window.AudioContext || window.webkitAudioContext;
    if(Ctx) audioCtx = new Ctx();
  }
}
function beep(freq=440, dur=0.05, type="sine", gain=0.05){
  if(!state.sound) return;
  ensureAudio();
  if(!audioCtx) return;
  if(audioCtx.state === "suspended"){ audioCtx.resume().catch(()=>{}); }
  const o = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  o.type = type;
  o.frequency.value = freq;
  g.gain.value = gain;
  o.connect(g); g.connect(audioCtx.destination);
  o.start();
  o.stop(audioCtx.currentTime + dur);
}
function sSwipe(){ beep(520, 0.03, "triangle", 0.03); }
function sPick(){ beep(880, 0.04, "square", 0.03); }
function sWin(){ beep(740, 0.05, "sine", 0.04); setTimeout(()=>beep(980,0.06,"sine",0.04), 70); }

/* ================== Screens & nav ================== */
const screens = ["s-on1","s-on2","s-on3","s-play","s-recap","s-leagues","s-crowd","s-profile","s-creator"];
let current = "s-on1";

function show(id){
  screens.forEach(s=>{
    const el = document.getElementById(s);
    if(el) el.classList.toggle("active", s===id);
  });
  current = id;

  // nav highlight
  document.querySelectorAll(".nav .item").forEach(i=>{
    i.classList.toggle("active", i.dataset.go===id);
  });

  // progress only for onboarding
  const onSteps = ["s-on1","s-on2","s-on3"];
  if(onSteps.includes(id)){
    const idx = onSteps.indexOf(id)+1;
    $("uiProg").style.width = (idx/onSteps.length*100) + "%";
    $("uiStepHint").textContent = `Step ${idx}/${onSteps.length}`;
  }else{
    $("uiProg").style.width = "100%";
    $("uiStepHint").textContent = "Ready";
  }

  render();
}

document.querySelectorAll(".nav .item").forEach(i=>{
  i.addEventListener("click", ()=>{ beep(520,0.03,"triangle",0.03); show(i.dataset.go); });
});

$("btnOn1").addEventListener("click", ()=>{ beep(520,0.03,"triangle",0.03); show("s-on2"); });
$("btnOn2").addEventListener("click", ()=>{ beep(520,0.03,"triangle",0.03); show("s-on3"); });
$("btnStartPlay").addEventListener("click", ()=>{ beep(520,0.03,"triangle",0.03); show("s-play"); });
$("btnCreator").addEventListener("click", ()=>{ beep(520,0.03,"triangle",0.03); show("s-creator"); });
$("btnBackHome").addEventListener("click", ()=>{ beep(520,0.03,"triangle",0.03); show("s-play"); });

$("btnResetAll").addEventListener("click", ()=>{
  localStorage.removeItem(KEY);
  state = defaultState();
  save();
  qIndex = 0;
  setQuestion(qIndex);
  show("s-on1");
});

/* Swipe */
let touchX = 0;
document.addEventListener("touchstart", (e)=>{ touchX = e.touches[0].clientX; }, {passive:true});
document.addEventListener("touchend", (e)=>{
  const dx = e.changedTouches[0].clientX - touchX;
  if(Math.abs(dx) < 60) return;

  const onOrder = ["s-on1","s-on2","s-on3"];
  const mainOrder = ["s-play","s-recap","s-leagues","s-crowd","s-profile","s-creator"];

  if(onOrder.includes(current)){
    const idx = onOrder.indexOf(current);
    if(dx < 0 && idx < onOrder.length-1){ sSwipe(); show(onOrder[idx+1]); }
    if(dx > 0 && idx > 0){ sSwipe(); show(onOrder[idx-1]); }
    return;
  }
  if(mainOrder.includes(current)){
    const idx = mainOrder.indexOf(current);
    if(dx < 0 && idx < mainOrder.length-1){ sSwipe(); show(mainOrder[idx+1]); }
    if(dx > 0 && idx > 0){ sSwipe(); show(mainOrder[idx-1]); }
  }
}, {passive:true});

/* ================== Pitch mode ================== */
let pitchRunning = false;
let pitchTimer = null;
function stopPitch(){
  pitchRunning = false;
  $("btnPitch").textContent = "Pitch mode";
  if(pitchTimer) clearTimeout(pitchTimer);
  pitchTimer = null;
}
function runPitch(){
  if(pitchRunning){ stopPitch(); return; }
  pitchRunning = true;
  $("btnPitch").textContent = "Stop";
  const seq = ["s-on1","s-on2","s-on3","s-play"];
  let i = 0;
  const step = ()=>{
    if(!pitchRunning) return;
    show(seq[i]);
    i++;
    if(i >= seq.length){ stopPitch(); return; }
    pitchTimer = setTimeout(step, 1300);
  };
  step();
}
$("btnPitch").addEventListener("click", ()=>{ beep(520,0.03,"triangle",0.03); runPitch(); });

/* ================== Sound toggle ================== */
function updateSoundBtn(){
  $("btnSound").textContent = state.sound ? "Sound: ON" : "Sound: OFF";
}
$("btnSound").addEventListener("click", ()=>{
  state.sound = !state.sound;
  save();
  updateSoundBtn();
  if(state.sound){ ensureAudio(); beep(660,0.05,"sine",0.04); }
});

/* ================== Share-card tabs ================== */
document.querySelectorAll(".tab").forEach(t=>{
  t.addEventListener("click", ()=>{
    document.querySelectorAll(".tab").forEach(x=>x.classList.remove("active"));
    t.classList.add("active");
    state.shareCardMode = t.dataset.card;
    save();
    beep(520,0.03,"triangle",0.03);
  });
});

/* ================== Context lines ================== */
function pickContextLines(){
  // pick 2 unique lines
  const a = Math.floor(Math.random() * CONTEXT_POOL.length);
  let b = Math.floor(Math.random() * CONTEXT_POOL.length);
  if(b === a) b = (b + 1) % CONTEXT_POOL.length;
  return [CONTEXT_POOL[a], CONTEXT_POOL[b]];
}
let currentContext = pickContextLines();
function renderContext(){
  const box = $("ctxLines");
  if(!box) return;
  box.innerHTML = "";
  currentContext.forEach(([emo,text])=>{
    const div = document.createElement("div");
    div.className = "ctxLine";
    div.innerHTML = `<div class="ctxEmoji">${emo}</div><div>${text}</div>`;
    box.appendChild(div);
  });
}

/* ================== Question ================== */
function setQuestion(i){
  const q = QUESTIONS[i % QUESTIONS.length];
  $("qSym").textContent = q.sym;
  $("qPx").textContent = money(q.px);
  $("qTitle").textContent = q.title;
  $("qHorizon").textContent = `Horizon: ${q.horizon}`;
  $("qCrowd").textContent = q.crowdUp + "%";
  $("qChance").textContent = q.chance;
  $("qBar").style.width = q.crowdUp + "%";
  $("qMode").textContent = q.mode;
  currentContext = pickContextLines();
  renderContext();
}

/* Next demo question */
$("btnNextQ").addEventListener("click", ()=>{
  qIndex = (qIndex+1) % QUESTIONS.length;
  setQuestion(qIndex);
  beep(520,0.03,"triangle",0.03);
});

/* ================== Mystery drops ================== */
const DROPS = [
  "üéÅ Early Signal Preview",
  "üéÅ +5 Bonus IQ",
  "üéÅ ‚ÄúGenesis Spark‚Äù badge",
  "üéÅ Double streak protection",
  "üéÅ Access: Pro context (demo)"
];
function rollDrop(){
  // ~22% chance
  if(Math.random() > 0.22) return "‚Äî";
  const d = DROPS[Math.floor(Math.random()*DROPS.length)];
  state.drops.unlocked += 1;
  state.drops.last = d;
  return d;
}

/* ================== Outcome simulation ================== */
function simulateOutcome(q){
  // slight bias to crowd, small edge with higher IQ
  const crowdProb = q.crowdUp/100;
  const iqEdge = clamp((state.iq-1000)/3000, -0.08, 0.08);
  const upProb = clamp(crowdProb + iqEdge, 0.35, 0.65);
  return (Math.random() < upProb) ? "UP" : "DOWN";
}
function scorePick(correct){
  const base = 10;
  return correct ? (base + Math.floor(Math.random()*6)) : -(base - 3);
}

/* ================== Play ================== */
function play(choice){
  weeklyResetIfNeeded();

  const t = todayISO();
  if(state.lastPlayDate === t){
    showReward("Already played today", "Come back tomorrow for the next daily battle.", 0, 0, 0, "‚Äî");
    return;
  }

  sPick();

  const q = QUESTIONS[qIndex % QUESTIONS.length];
  const outcome = simulateOutcome(q);
  const correct = (choice === outcome);

  const delta = scorePick(correct);
  state.iq = Math.max(700, state.iq + delta);

  // streak
  const yesterday = new Date(Date.now()-86400000).toISOString().slice(0,10);
  if(state.lastPlayDate === yesterday) state.streak += 1;
  else state.streak = 1;

  state.lastPlayDate = t;
  state.answeredToday = 1;

  // crowd result
  const crowdPick = crowdPickFromPct(q.crowdUp);
  const crowdCorrect = (crowdPick === outcome);

  // edge vs crowd
  state.edgeToday = (correct?1:0) - (crowdCorrect?1:0);

  // battle score (season)
  if(correct) state.battle.you += 1;
  if(crowdCorrect) state.battle.crowd += 1;

  // crowd vs experts season score
  const expertPick = (q.crowdUp >= 50) ? "DOWN" : "UP";
  if(outcome === crowdPick) state.cve.crowd += 1;
  if(outcome === expertPick) state.cve.experts += 1;

  // duel season score
  if(state.duel.active){
    state.duel.you += correct ? 1 : 0;
    state.duel.friend += (Math.random() < 0.52) ? 1 : 0;
  }

  // store pick
  state.picks.unshift({ date:t, sym:q.sym, horizon:q.horizon, choice, crowdUp:q.crowdUp, outcome, correct, crowdCorrect });
  state.picks = state.picks.slice(0, 60);

  // identity update
  recomputeIdentity();

  // mystery drop
  const drop = rollDrop();

  save();

  if(correct) sWin();

  showReward(
    correct ? "Win ‚úÖ" : "Loss ‚ùå",
    `You picked ${choice}. Outcome: ${outcome}. Crowd picked ${crowdPick}.`,
    delta,
    1,
    state.edgeToday,
    drop
  );
}

$("btnUp").addEventListener("click", ()=> play("UP"));
$("btnDown").addEventListener("click", ()=> play("DOWN"));

/* ================== Reward modal ================== */
function showReward(title, desc, iqDelta, streakDelta, edgeDelta, dropText){
  $("rwTitle").textContent = title;
  $("rwDesc").textContent = desc;
  $("rwIQ").textContent = (iqDelta>=0?"+":"") + iqDelta;
  $("rwStreak").textContent = "+" + streakDelta;
  $("rwEdge").textContent = (edgeDelta>=0?"+":"") + edgeDelta;
  $("rwDrop").textContent = dropText || "‚Äî";
  $("overlay").classList.add("show");
}
function hideReward(){ $("overlay").classList.remove("show"); }
$("rwClose").addEventListener("click", hideReward);
$("rwGoRecap").addEventListener("click", ()=>{ hideReward(); show("s-recap"); });
$("rwShareText").addEventListener("click", async ()=>{ await shareOrCopyText(shareText()); });

/* ================== Share text ================== */
function shareText(){
  const acc = accuracyLast(30);
  const accTxt = acc===null ? "‚Äî" : Math.round(acc) + "%";
  const top = topPercentApprox(state.iq);

  const last = state.picks[0];
  const lastLine = last ? `Crowd: ${last.crowdUp}% UP ‚Ä¢ I chose ${last.choice} ‚Ä¢ Outcome: ${last.outcome}` : "No picks yet";

  return [
    `Market IQ`,
    `I beat ${top} of traders (demo).`,
    `IQ: ${state.iq} (${leagueFromIQ(state.iq)}) ‚Ä¢ Type: ${state.identity.type}`,
    `Streak: ${state.streak} day(s) ‚Ä¢ Accuracy: ${accTxt}`,
    lastLine,
    ``,
    `Can you beat me?`,
    location.href
  ].join("\n");
}
async function shareOrCopyText(text){
  try{
    if(navigator.share){
      await navigator.share({ title:"Market IQ", text, url: location.href });
      return true;
    }
  }catch{}
  try{ await navigator.clipboard.writeText(text); return true; }catch{}
  alert(text);
  return false;
}
$("btnShareText").addEventListener("click", async ()=>{ beep(520,0.03,"triangle",0.03); await shareOrCopyText(shareText()); });

/* ================== Share-card PNG (canvas -> file share or download) ================== */
function drawRounded(ctx, x, y, w, h, r){
  const rr = Math.min(r, w/2, h/2);
  ctx.beginPath();
  ctx.moveTo(x+rr,y);
  ctx.arcTo(x+w,y,x+w,y+h,rr);
  ctx.arcTo(x+w,y+h,x,y+h,rr);
  ctx.arcTo(x,y+h,x,y,rr);
  ctx.arcTo(x,y,x+w,y,rr);
  ctx.closePath();
}

function buildCardPayload(mode){
  const acc = accuracyLast(30);
  const d = {
    mode,
    iq: state.iq,
    league: leagueFromIQ(state.iq),
    streak: state.streak,
    top: topPercentApprox(state.iq),
    acc: acc===null ? "‚Äî" : (Math.round(acc) + "%"),
    type: state.identity.type || "Data Mind",
    season: state.season,
    battle: { you: state.battle.you, crowd: state.battle.crowd },
    last: state.picks[0] || null
  };
  return d;
}

function cardTitle(mode){
  if(mode==="battle") return "YOU vs CROWD";
  if(mode==="streak") return "STREAK FLEX";
  return "STATUS FLEX";
}
function cardHeadline(d){
  if(d.mode==="battle"){
    const crowdLine = d.last ? `Crowd: ${d.last.crowdUp}% UP` : "Crowd: ‚Äî";
    const youLine = d.last ? `Me: ${d.last.choice}` : "Me: ‚Äî";
    return [crowdLine, youLine, "Who was right?"];
  }
  if(d.mode==="streak"){
    return [`${d.streak}-DAY STREAK`, "Still alive.", "Can you beat me?"];
  }
  // status
  return [`I beat ${d.top} of traders`, `IQ ${d.iq} ‚Ä¢ ${d.league}`, `Type: ${d.type}`];
}

async function generateShareCardPNG(mode){
  const d = buildCardPayload(mode);

  // X-friendly size: 1200x675 (fast)
  const W = 1200, H = 675;
  const canvas = document.createElement("canvas");
  canvas.width = W; canvas.height = H;
  const ctx = canvas.getContext("2d");

  // bg
  const g = ctx.createLinearGradient(0,0,W,H);
  g.addColorStop(0, "#020617");
  g.addColorStop(1, "#07102a");
  ctx.fillStyle = g;
  ctx.fillRect(0,0,W,H);

  // glow blobs
  ctx.globalAlpha = 0.22;
  ctx.fillStyle = "#22d3ee";
  ctx.beginPath(); ctx.ellipse(250,180,220,160,0,0,Math.PI*2); ctx.fill();
  ctx.fillStyle = "#fbbf24";
  ctx.beginPath(); ctx.ellipse(980,140,240,170,0,0,Math.PI*2); ctx.fill();
  ctx.fillStyle = "#22c55e";
  ctx.beginPath(); ctx.ellipse(860,560,260,180,0,0,Math.PI*2); ctx.fill();
  ctx.globalAlpha = 1;

  // card
  ctx.fillStyle = "rgba(255,255,255,0.06)";
  ctx.strokeStyle = "rgba(255,255,255,0.14)";
  ctx.lineWidth = 2;
  drawRounded(ctx, 60, 70, W-120, H-140, 34);
  ctx.fill(); ctx.stroke();

  // label
  ctx.fillStyle = "rgba(34,211,238,0.95)";
  ctx.font = "900 18px ui-sans-serif, system-ui";
  ctx.fillText("MARKET IQ", 110, 135);

  ctx.fillStyle = "rgba(229,231,235,0.92)";
  ctx.font = "950 18px ui-sans-serif, system-ui";
  ctx.fillText(cardTitle(d.mode), 980, 135);

  // headline
  const lines = cardHeadline(d);
  ctx.fillStyle = "rgba(229,231,235,0.95)";
  ctx.font = "950 48px ui-sans-serif, system-ui";
  ctx.fillText(lines[0], 110, 220);
  ctx.fillText(lines[1], 110, 280);
  ctx.fillText(lines[2], 110, 340);

  // stats mini blocks
  const blocks = [
    {k:"IQ", v:String(d.iq), c:"#22d3ee"},
    {k:"League", v:d.league, c:"#fbbf24"},
    {k:"Type", v:d.type, c:"rgba(229,231,235,0.92)"},
    {k:"Top", v:d.top, c:"#22c55e"},
    {k:"Accuracy", v:d.acc, c:"#22c55e"},
    {k:"Season", v:String(d.season), c:"rgba(229,231,235,0.92)"}
  ];

  const bx = 110, by = 380, bw = 980, bh = 80, gap = 12;
  const colW = (bw - gap*2)/3;

  function statBox(i, x, y){
    const b = blocks[i];
    ctx.fillStyle = "rgba(0,0,0,0.28)";
    ctx.strokeStyle = "rgba(255,255,255,0.12)";
    ctx.lineWidth = 2;
    drawRounded(ctx, x, y, colW, bh, 22);
    ctx.fill(); ctx.stroke();

    ctx.fillStyle = "rgba(148,163,184,0.92)";
    ctx.font = "900 14px ui-sans-serif, system-ui";
    ctx.fillText(b.k, x+18, y+28);

    ctx.fillStyle = b.c;
    ctx.font = "980 26px ui-sans-serif, system-ui";
    // shorten long type
    let vv = b.v;
    if(b.k==="Type" && vv.length>16) vv = vv.slice(0,16) + "‚Ä¶";
    ctx.fillText(vv, x+18, y+62);
  }

  statBox(0, bx, by);
  statBox(1, bx+colW+gap, by);
  statBox(2, bx+(colW+gap)*2, by);

  statBox(3, bx, by+bh+gap);
  statBox(4, bx+colW+gap, by+bh+gap);
  statBox(5, bx+(colW+gap)*2, by+bh+gap);

  // battle footer (if mode battle)
  if(d.mode==="battle"){
    ctx.fillStyle = "rgba(148,163,184,0.95)";
    ctx.font = "900 16px ui-sans-serif, system-ui";
    ctx.fillText(`Season battle score ‚Äî You: ${d.battle.you} | Crowd: ${d.battle.crowd}`, 110, 625);
  } else {
    ctx.fillStyle = "rgba(148,163,184,0.95)";
    ctx.font = "900 16px ui-sans-serif, system-ui";
    const txt = d.last ? `Last: ${d.last.sym} ‚Ä¢ Me: ${d.last.choice} ‚Ä¢ Outcome: ${d.last.outcome}` : "Last: ‚Äî";
    const short = txt.length>86 ? txt.slice(0,86)+"‚Ä¶" : txt;
    ctx.fillText(short, 110, 625);
  }

  // link
  ctx.fillStyle = "rgba(34,211,238,0.92)";
  ctx.font = "900 16px ui-sans-serif, system-ui";
  ctx.fillText(location.href.replace(/^https?:\/\//,""), 860, 625);

  return new Promise((resolve)=>{
    canvas.toBlob((blob)=> resolve(blob), "image/png", 0.92);
  });
}

async function shareCardPNG(mode){
  const blob = await generateShareCardPNG(mode);
  const file = new File([blob], `market-iq-${mode}.png`, {type:"image/png"});

  try{
    if(navigator.canShare && navigator.canShare({ files:[file] })){
      await navigator.share({ title:"Market IQ", text:"Can you beat me?", files:[file] });
      return true;
    }
  }catch{}

  // download fallback
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = `market-iq-${mode}.png`;
  document.body.appendChild(a);
  a.click();
  a.remove();
  setTimeout(()=> URL.revokeObjectURL(url), 1500);
  return true;
}

async function shareCardAndHint(){
  beep(520,0.03,"triangle",0.03);
  const mode = state.shareCardMode || "status";
  await shareCardPNG(mode);
  const h = $("shareHint");
  if(h){
    h.style.display = "block";
    setTimeout(()=> h.style.display="none", 1400);
  }
}

$("btnSharePNG").addEventListener("click", shareCardAndHint);
$("btnShareCardTop").addEventListener("click", shareCardAndHint);

/* ================== Crowd post + duel ================== */
$("btnHotPost").addEventListener("click", async ()=>{
  beep(520,0.03,"triangle",0.03);
  const q = QUESTIONS[qIndex % QUESTIONS.length];
  const last = state.picks[0];
  const line = last
    ? `Crowd: ${last.crowdUp}% UP ‚Ä¢ I chose ${last.choice} ‚Ä¢ Outcome: ${last.outcome}`
    : `Crowd: ${q.crowdUp}% UP on ${q.sym}`;
  const text =
`${line}
Battle score: You ${state.battle.you} ‚Äî Crowd ${state.battle.crowd}
My IQ: ${state.iq} (${leagueFromIQ(state.iq)}) ‚Ä¢ Type: ${state.identity.type}
${location.href}`;
  try{ await navigator.clipboard.writeText(text); }catch{ alert(text); }
});

$("btnStartDuel").addEventListener("click", ()=>{
  beep(520,0.03,"triangle",0.03);
  state.duel.active = true;
  state.duel.you = 0;
  state.duel.friend = 0;
  save();
  render();
});

/* ================== Render ================== */
function render(){
  weeklyResetIfNeeded();

  // header
  $("uiIQ").textContent = state.iq;
  $("uiLeague").textContent = leagueFromIQ(state.iq);
  $("uiType").textContent = state.identity.type || "‚Äî";
  $("uiGenesis").textContent = state.genesis ? "ON" : "OFF";

  $("sbSeason").textContent = `Season ${state.season}`;
  updateResetBadge();

  updateSoundBtn();

  // today
  $("uiAnswered").textContent = `${state.answeredToday}/1`;
  $("uiEdge").textContent = (state.edgeToday>=0?"+":"") + state.edgeToday;

  // battle scores
  $("uiYouScore").textContent = state.battle.you;
  $("uiCrowdScore").textContent = state.battle.crowd;

  // recap
  const you = state.answeredToday ? (state.picks[0]?.correct ? 1 : 0) : 0;
  const crowd = state.answeredToday ? (state.picks[0]?.crowdCorrect ? 1 : 0) : 0;

  $("recYou").textContent = `${you}/1`;
  $("recCrowd").textContent = `${crowd}/1`;
  $("recTop").textContent = topPercentApprox(state.iq);
  $("recStreak").textContent = state.streak;
  $("recIQ").textContent = state.iq;
  $("recType").textContent = state.identity.type || "‚Äî";

  // history
  const hist = $("hist");
  hist.innerHTML = "";
  const items = state.picks.slice(0, 6);
  if(items.length===0){
    hist.innerHTML = `<div class="kv"><span class="k">No picks yet</span><span class="v">Make a pick on Play</span></div>`;
  }else{
    items.forEach(p=>{
      const badge = p.correct ? `<span class="chip green">‚úÖ</span>` : `<span class="chip red">‚ùå</span>`;
      hist.insertAdjacentHTML("beforeend", `
        <div class="kv">
          <span class="k">${p.sym} ‚Ä¢ ${p.date} ‚Ä¢ You: ${p.choice} ‚Ä¢ Outcome: ${p.outcome} ‚Ä¢ Crowd: ${p.crowdUp}% UP</span>
          <span class="v">${badge}</span>
        </div>
      `);
    });
  }

  // leagues
  const verified = (state.iq >= 1250 && state.streak >= 10);
  const creator = (state.iq >= 1200 && state.streak >= 7);

  $("lgLeague").textContent = leagueFromIQ(state.iq);
  $("lgSeason").textContent = `Season ${state.season}`;
  $("lgGenesis").textContent = state.genesis ? "Enabled" : "Disabled";
  $("lgVerified").textContent = verified ? "Unlocked" : "Locked";
  $("lgCreator").textContent = creator ? "Eligible" : "Locked";

  // leaderboard (demo)
  const lb = $("lb");
  lb.innerHTML = "";
  const demoLB = [
    {name:"NeoMacro", iq:1820},
    {name:"QuantFox", iq:1650},
    {name:"You", iq:state.iq},
    {name:"CandleKid", iq:1180},
    {name:"RetailPro", iq:1125}
  ].sort((a,b)=>b.iq-a.iq);
  demoLB.forEach((u,i)=>{
    lb.insertAdjacentHTML("beforeend", `
      <div class="kv">
        <span class="k">#${i+1} ${u.name}</span>
        <span class="v">${u.iq} ‚Ä¢ ${leagueFromIQ(u.iq)}</span>
      </div>
    `);
  });

  // crowd vs experts
  $("cveCrowd").textContent = state.cve.crowd;
  $("cveExperts").textContent = state.cve.experts;
  $("cveScore").textContent = `Crowd ${state.cve.crowd} ‚Äî Experts ${state.cve.experts}`;

  // duel
  $("duelState").textContent = state.duel.active ? "Active" : "Inactive";
  $("duelYou").textContent = state.duel.you;
  $("duelFriend").textContent = state.duel.friend;

  // drops
  $("dropState").textContent = state.drops.last || "‚Äî";

  // profile
  $("pfIQ").textContent = state.iq;
  $("pfLeague").textContent = leagueFromIQ(state.iq);
  const acc = accuracyLast(30);
  $("pfAcc").textContent = acc===null ? "‚Äî" : Math.round(acc) + "%";

  const badges = [];
  if(state.genesis) badges.push({t:"Genesis", cls:"gold"});
  if(state.streak>=7) badges.push({t:"7-day streak", cls:"gold"});
  if(verified) badges.push({t:"Verified Mind", cls:"cyan"});
  if(creator) badges.push({t:"Creator eligible", cls:"green"});
  if(state.drops.unlocked>=1) badges.push({t:"Mystery drop", cls:"gold"});

  const pfBadges = $("pfBadges");
  pfBadges.innerHTML = "";
  if(badges.length===0){
    pfBadges.innerHTML = `<span class="chip">No badges yet</span>`;
  }else{
    badges.forEach(b=> pfBadges.insertAdjacentHTML("beforeend", `<span class="chip ${b.cls}">${b.t}</span>`));
  }

  // identity evolution
  $("pfType").textContent = state.identity.type || "‚Äî";
  const evo = state.identity.evo || [];
  const evoText = evo.length
    ? evo.slice(0,4).map(e=>`${e.week}: ${e.type}`).join(" ‚Üí ")
    : `This week: ${state.seasonKey || getWeekKey()} (${state.identity.type || "‚Äî"})`;
  $("pfEvo").textContent = evoText.length>70 ? evoText.slice(0,70) + "‚Ä¶" : evoText;

  $("pfElig").textContent = creator ? "Eligible ‚úÖ" : "Not yet";

  // creator
  $("crStatus").textContent = creator ? "Eligible ‚úÖ" : "Locked";
  $("crAcc").textContent = acc===null ? "‚Äî" : Math.round(acc) + "%";
  $("crStreak").textContent = state.streak;
  $("crLeague").textContent = leagueFromIQ(state.iq);
  $("crType").textContent = state.identity.type || "‚Äî";

  // right box X copy
  const last = state.picks[0];
  $("xCopy").textContent = last
    ? `Crowd: ${last.crowdUp}% UP on ${last.sym}\nI chose ${last.choice}\nOutcome: ${last.outcome}\nMy Market IQ: ${state.iq} (${leagueFromIQ(state.iq)})\nType: ${state.identity.type}\n${location.href}`
    : `Crowd: ${QUESTIONS[qIndex % QUESTIONS.length].crowdUp}% UP on ${QUESTIONS[qIndex % QUESTIONS.length].sym}\nI chose ?\nMy Market IQ: ${state.iq} (${leagueFromIQ(state.iq)})\nType: ${state.identity.type}\n${location.href}`;
}

/* ================== Timer ticks (light) ================== */
function tick(){
  const tEl = $("qTimer");
  if(tEl) tEl.textContent = closeTimerText();
  updateResetBadge();
  setTimeout(tick, 1000);
}

/* ================== Init ================== */
weeklyResetIfNeeded();
recomputeIdentity();
updateSoundBtn();
setQuestion(qIndex);
renderContext();
save();
render();
tick();

/* first-run behavior */
if(state.picks.length > 0 || state.lastPlayDate){
  show("s-play");
}else{
  show("s-on1");
}

/* ================== Share-card mode sync ================== */
(function syncTabs(){
  const mode = state.shareCardMode || "status";
  document.querySelectorAll(".tab").forEach(t=>{
    t.classList.toggle("active", t.dataset.card === mode);
  });
})();

/* ================== Extra: top share-card button uses current mode ================== */
$("btnShareCardTop").addEventListener("click", shareCardAndHint);
</script>
</body>
</html>
